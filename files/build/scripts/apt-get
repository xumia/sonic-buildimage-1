#!/bin/bash

INSTALL=

VERSION_FILE="/usr/local/share/buildinfo/base-versions/versions-deb"
for para in $@
do
    if [[ "$para" != -* ]]; then
        continue
    fi
    if [ ! -z "$INSTALL" ]; then
        if [[ "$para" == *=* ]]; then
            continue
            package=$(echo "$para" | cut -d= -f1)
            version=$(echo "$para" | cut -d= -f2)
            if grep "^${package}=" $VERSION_FILE; then
                if ! grep "^${package}==${version}$" $VERSION_FILE; then
                    EXPECTED_VERSION=$(grep "^${package}=" $VERSION_FILE | cut -d= -f3)
                    echo "${package}=${version}, expected version is ${EXPECTED_VERSION}"
                    exit 1
                fi
            fi
        else
            if ! grep "^${package}=" $VERSION_FILE; then
                echo "The version of the package ${package} is not specified."
                exit 1
            fi
        fi
    elif [[ "$para" == "install"  ]]; then
        INSTALL=y
    fi
done


/usr/bin/apt-get $@

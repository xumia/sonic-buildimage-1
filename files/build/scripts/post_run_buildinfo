#!/bin/bash

. /usr/local/share/buildinfo/config/buildinfo.config

[ -d $POST_VERSION_PATH ] && rm -rf $POST_VERSION_PATH

collect_version_files $POST_VERSION_PATH
chmod -R a+rw $BUILDINFO_PATH

for file in $POST_VERSION_PATH/versions-*
do
    filename=$(basename $file)
    init_file=$PRE_VERSION_PATH/$filename
    diff_file=$DIFF_VERSION_PATH/$filename
    cat $file | sort > $diff_file
    if [ -f $init_file ]; then
        cat $file $init_file | sort | LC_ALL=C uniq -u > $diff_file
    fi
done

[ -d $BUILD_VERSION_PATH ] && cp -rf $BUILD_VERSION_PATH/* $POST_VERSION_PATH/
rm -rf $BUILD_VERSION_PATH/*

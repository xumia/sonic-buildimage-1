#!/bin/bash

. /usr/local/share/buildinfo/config/buildinfo.config

[ -z "$PIP_COMPONENT" ] && PIP_COMPONENT=py2

if [ "$PIP_COMPONENT" == "py2" ]; then
    PIP_COMMAND=/usr/local/bin/pip
    [ ! -f $PIP_COMMAND ] && PIP_COMMAND=/usr/bin/pip
else
    PIP_COMMAND=/usr/bin/pip3
fi

VERSION_FILE="$BUILDINFO_PATH/versions/versions-${PIP_COMPONENT}"
ENABLE_VERSION_CONTROL=$(check_version_control "$PIP_COMPONENT")

if [ "$ENABLE_VERSION_CONTROL" != "y" ]; then
    $PIP_COMMAND "$@"
    exit $?
fi

paras=("$@")
FOUND=false
INSTALL=false
for para in "${paras[@]}"
do
    ([ "$para" == "-c" ] || [ "$para" == "--constraint" ]) && FOUND=true
    [ "$para" == "install" ] && INSTALL=true
done

if [ "$SONIC_ENABLE_VERSION_CONTROL" == "y" ] && [ "$FOUND" == "false" ] && [ "$INSTALL" == "true" ]; then
    paras+=("-c")
    paras+=("${VERSION_FILE}")
fi


$PIP_COMMAND ${paras[@]}
